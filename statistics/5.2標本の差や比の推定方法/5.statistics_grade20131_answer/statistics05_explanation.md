# 第5回　推測統計③

#### ■ 問1　母平均の差の区間推定（対応のあるデータ）

<b>区間推定の流れ</b>
データ$x_{1}$とデータ$x_{2}$が互いに独立にそれぞれ$N_{1}(\mu_{1}, \sigma^{2}_{1})$、$N_{2}(\mu_{2}, \sigma^{2}_{2})$に従うとき、
$x_{1} + x_{2}$は$N(\mu_{1} + \mu_{2}, \sigma^{2}_{1} + \sigma^{2}_{2})$に従う。（第3回「正規分布の再生性」）
ただし、互いに独立ではない場合、すなわちデータ$x_{1}$とデータ$x_{2}$に対応がある場合は独立性が成り立たない。
$$
x_{1} = a_{1} + \epsilon\\
x_{2} = a_{2} + \epsilon
$$
のように、対応を表す項$\epsilon$が付いている場合、この対応を表す項$\epsilon$を削除するように差をとって考えると良い。
2つの標本の差$x_{1}-x_{2}$を1つの標本と考え、母分散未知の場合の母平均の推定と同様に考える。

①2つの標本の差の値をそれぞれ算出する。
②その差のデータから、平均値と不偏分散を算出する。
③統計量$t$の式を考える（操作は標本平均の標準化と同じ）。
④信頼係数95%の場合、統計量$t$が$t$分布の真ん中95%の面積の範囲にあれば良い。
⑤すなわち、左側2.5%、右側2.5%に入らなければ良い。
⑥$t$分布は左右対称なので、自由度$m$のときの正の値の右側2.5%(0.025)の位置を$t$分布表から調べる。
⑦$t$分布表から、自由度5のときの右側2.5%の位置は2.571だとわかる。（-2.571が左側2.5%の位置）
⑧$-2.571\leq\frac{\bar{x}-\mu_{d}}{\sqrt{s_{d}^{2}/n}}\leq2.571$が信頼係数95%の信頼区間となる。
⑨これを$\mu_{d}$について解くと、$\bar{x}-2.571\sqrt{\frac{s_{d}^{2}}{n}}\leq\mu_{d}\leq\bar{x}+2.571\sqrt{\frac{s_{d}^{2}}{n}}$となる。
⑩これが求めたい信頼区間となる。

■ 解答
1.　点数の差の平均値：0.2
$$
\begin{align}
\bar{d} &= \frac{(8.0 - 7.0) + (5.4 - 5.0) + (4.8 - 3.6) + (5.8 - 7.0) + (6.4 - 7.0) + (5.8 - 5.4)}{6}\\
\,\\
&= \frac{1 + 0.4 + 1.2 + (-1.2) + (- 0.6) + 0.4}{6}\\
\,\\
&= 0.2
\end{align}
$$

2.　点数の差の不偏分散：0.864
$$
\begin{align}
s_{d} &= \frac{(1.0 - 0.2)^{2} + (0.4 - 0.2)^{2} + (1.2 - 0.2)^{2} + (-1.2 - 0.2)^{2} + (-0.6 - 0.2)^{2} + (0.4 - 0.2)^{2}}{6 - 1}\\
\,\\
&= \frac{(0.8)^{2} + (0.2)^{2} + (1.0)^{2} + (-1.4)^{2} + (-0.8)^{2} + (0.2)^{2}}{5}\\
\,\\
&= 0.864
\end{align}
$$

3.　95%信頼区間：(-0.78, 1.18)
まず、統計量$t$を考える。
$$t = \frac{\bar{d}-\mu_{d}}{\sqrt{s^{2}_{d}/n}}$$

次に、自由度5の右側2.5%(0.025)の位置を$t$分布表から調べる。
<img src="01.png" width="500">

2.571だとわかったので、$-2.571\leq\frac{\bar{d}-\mu_{d}}{\sqrt{s^{2}_{d}/n}}\leq2.571$が信頼係数95%の信頼区間。
これを$\mu_{d}$について解く。
$$
-2.571\leq\frac{\bar{d}-\mu_{d}}{\sqrt{s^{2}_{d}/n}}\leq2.571\\
\,\\
\bar{d}-2.571\sqrt{\frac{s^{2}_{d}}{n}}\leq\mu_{d}\leq\bar{d}+2.571\sqrt{\frac{s^{2}_{d}}{n}}
$$となる。

最後に、文字に値を代入して信頼区間を求める。

$\bar{d} = 0.2, n = 6, s^{2}_{d} = 0.864$より、
$$
0.2-2.571\sqrt{\frac{0.864}{6}}\leq\mu\leq0.2+2.571\sqrt{\frac{0.864}{6}}\\
\,\\
0.2-2.571×0.3795\leq\mu\leq0.2+2.571×0.3795\\
\,\\
-0.776\leq\mu\leq1.176
$$
よって、95%信頼区間は(-0.78, 1.18)

#### ■ 問2　Pythonを使って母平均の差の区間推定（対応のあるデータ）

Notebook参照

#### ■ 問3　母平均の差の区間推定（対応のないデータ）

<b>区間推定の流れ</b>
データ$x_{1}$とデータ$x_{2}$が互いに独立にそれぞれ$N_{1}(\mu_{1}, \sigma^{2}_{1})$、$N_{2}(\mu_{2}, \sigma^{2}_{2})$に従うとき、
$x_{1} + x_{2}$は$N(\mu_{1} + \mu_{2}, \sigma^{2}_{1} + \sigma^{2}_{2})$に従う。（第3回「正規分布の再生性」）
対応がない場合は独立性が成り立つ。
また、データ$x$が互いに独立に$N(\mu, \sigma^{2})$に従うとき、$\bar{x}$は$N(\mu, \sigma^{2}/n)$に従う。（第3回「統計量の分布」）
すなわち、データ$\bar{x}_{1}$とデータ$\bar{x}_{2}$の差をとった$\bar{x}_{1} - \bar{x}_{2}$は$N(\mu_{1} - \mu_{2}, \sigma^{2}_{1}/n_{1} + \sigma^{2}_{2}/n_{2})$に従う。
ただし、$\sigma^{2}_{1},\sigma^{2}_{2}$は不明なので不偏分散$s^{2}_{1}, s^{2}_{2}$を算出するが、以下の2つの場合に分けて考える。

<b>1. 2つの母分散が等しいと考えられる場合（$\sigma^{2}_{1} = \sigma^{2}_{2}$の場合）</b>

それぞれの不偏分散を算出し、その自由度で重み付けした加重平均を使う。
すなわち、
$$
\hat{\sigma^{2}} = s^{2} = \frac{(n_{1} - 1)s^{2}_{1} + (n_{2} - 1)s^{2}_{2}}{(n_{1} - 1) + (n_{2} - 1)}
$$
このとき、
$$
t = \frac{\bar{x}_{1} - \bar{x}_{2} - (\mu_{1} - \mu_{2})}{\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}}
$$
は自由度$n_{1} + n_{2} - 2$の$t$分布に従う。

<b>2. 2つの母分散が等しいかどうかわからない場合（$\sigma^{2}_{1} = \sigma^{2}_{2}$かどうかわからない場合）（Welchの検定）</b>

それぞれの不偏分散$s^{2}_{1}, s^{2}_{2}$を算出する。
このとき、
$$
t = \frac{\bar{x}_{1} - \bar{x}_{2} - (\mu_{1} - \mu_{2})}{\sqrt{\frac{s_{1}^{2}}{n_{1}} + \frac{s_{2}^{2}}{n_{2}}}}
$$
は自由度$\phi$の$t$分布に<u>近似的</u>に従う。
$$
\phi = \frac{\bigr(\frac{s^{2}_{1}}{n_{1}} + \frac{s^{2}_{2}}{n_{2}}\bigl)^{2}}{\frac{\bigr(\frac{s^{2}_{1}}{n_{1}}\bigl)^{2}}{n_{1} - 1} + \frac{\bigr(\frac{s^{2}_{2}}{n_{2}}\bigl)^{2}}{n_{2} - 1}}
$$

※
実際は$\sigma^{2}_{1}, \sigma^{2}_{2}$が未知なのに、$\sigma^{2}_{1} = \sigma^{2}_{2}$であることがわかっている状態は不自然。
しかし、毎回$\sigma^{2}_{1} = \sigma^{2}_{2}$かどうかわからないとして2.の方法を使うと、2.の方法は<u>近似的</u>なので、本当の範囲がずれる可能性がある。
また、自由度の計算も大変。
実際、$n_{1} \risingdotseq n_{2}$の場合は1.の方法でもほぼ正しい区間推定となるので、なるべく1.の方法を採用したい。
正確に行う場合は、$F$分布を使って$\sigma^{2}_{1} = \sigma^{2}_{2}$と言えるかどうか確認してから母平均の差の区間推定を行う。

1.の場合の手順
①2つの標本の平均値と不偏分散を算出する。
②2つの不偏分散から、自由度で重み付けした加重平均を算出する。
③統計量$t$の式を考える（操作は標本平均の標準化と同じ）。
④信頼係数95%の場合、統計量$t$が$t$分布の真ん中95%の面積の範囲にあれば良い。
⑤すなわち、左側2.5%、右側2.5%に入らなければ良い。
⑥$t$分布は左右対称なので、自由度$m$のときの正の値の右側2.5%(0.025)の位置を$t$分布表から調べる。
⑦$t$分布表から、自由度6 + 5 - 2 = 9ののときの右側2.5%の位置は2.262だとわかる。（-2.262が左側2.5%の位置）
⑧$-2.262\leq\frac{\bar{x}_{1} - \bar{x}_{2} - (\mu_{1} - \mu_{2})}{\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}}\leq2.262$が信頼係数95%の信頼区間となる。
⑨これを$\mu_{1} - \mu_{2}$について解くと、$\bar{x}_{1} - \bar{x}_{2}-2.262\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}\leq\mu_{1} - \mu_{2}\leq\bar{x}_{1} - \bar{x}_{2}+2.262\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}$となる。
⑩これが求めたい信頼区間となる。

■ 解答
1.　1組の平均値：6.0　2組の平均値：6.4
$$
\begin{align}
\bar{x}_{1} &= \frac{8.0 + 5.4 + 4.8 + 5.8 + 6.4 + 5.6}{6}\\
\,\\
&= 6.0\\
\,\\
\bar{x}_{2} &= \frac{9.0 + 7.0 + 3.6 + 6.4 + 6.0}{5}\\
\,\\
&= 6.4
\end{align}
$$

2.　1組の不偏分散：1.232　2組の不偏分散：3.78
$$
\begin{align}
s^{2}_{1} &= \frac{(8.0 - 6.0)^{2} + (5.4 - 6.0)^{2} + (4.8 - 6.0)^{2} + (5.8 - 6.0)^{2} + (6.4 - 6.0)^{2} + (5.6 - 6.0)^{2}}{6 - 1}\\
\,\\
&= \frac{(2.0)^{2} + (-0.6)^{2} + (-1.2)^{2} + (-0.2)^{2} + (0.4)^{2} + (-0.4)^{2}}{5}\\
\,\\
&= 1.232\\
\,\\
s^{2}_{2} &= \frac{(9.0 - 6.4)^{2} + (7.0 - 6.4)^{2} + (3.6 - 6.4)^{2} + (6.4 - 6.4)^{2} + (6.0 - 6.4)^{2}}{5 - 1}\\
\,\\
&= \frac{(2.6)^{2} + (0.6)^{2} + (-2.8)^{2} + (0)^{2} + (-0.4)^{2}}{}\\
\,\\
&= 3.78
\end{align}
$$

3.　不偏分散の加重平均：2.364
$$
\begin{align}
s^{2} &= \frac{(n_{1} - 1)s^{2}_{1} + (n_{2} - 1)s^{2}_{2}}{(n_{1} - 1) + (n_{2} - 1)}\\
\,\\
&=\frac{5 \times 1.232 + 4 \times 3.78}{5 + 4}\\
\,\\
&= 2.364
\end{align}
$$

4.　95%信頼区間：(-2.51, 1.71)
まず、統計量$t$を考える。
$$
t = \frac{\bar{x}_{1} - \bar{x}_{2} - (\mu_{1} - \mu_{2})}{\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}}
$$

次に、自由度9の右側2.5%(0.025)の位置を$t$分布表から調べる。
<img src="02.png" width="500">

2.262だとわかったので、$-2.262\leq\frac{\bar{x}_{1} - \bar{x}_{2} - (\mu_{1} - \mu_{2})}{\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}}\leq2.262$が信頼係数95%の信頼区間。
これを$\mu_{1} - \mu_{2}$について解く。
$$
-2.262\leq\frac{\bar{x}_{1} - \bar{x}_{2} - (\mu_{1} - \mu_{2})}{\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}}\leq2.262\\
\,\\
\bar{x}_{1} - \bar{x}_{2}-2.262\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}\leq\mu_{1} - \mu_{2}\leq\bar{x}_{1} - \bar{x}_{2}+2.262\sqrt{\frac{s^{2}}{n_{1}} + \frac{s^{2}}{n_{2}}}
$$となる。

最後に、文字に値を代入して信頼区間を求める。

$\bar{x}_{1} = 6.0, \bar{x}_{2} = 6.4, n_{1} = 6, n_{2} = 5, s^{2} = 2.364$より、
$$
6.0 - 6.4 - 2.262\sqrt{\frac{2.364}{6} + \frac{2.364}{5}}\leq\mu\leq6.0 - 6.4 + 2.262\sqrt{\frac{2.364}{6} + \frac{2.364}{5}}\\
\,\\
-0.4 - 2.262×0.931\leq\mu\leq-0.4 + 2.262×0.931\\
\,\\
-2.505\leq\mu\leq1.705
$$
よって、95%信頼区間は(-2.51, 1.71)

#### ■ 問4　母平均の差の区間推定（対応のないデータ）

Notebook参照

#### ■ 問5　母分散の比の区間推定

<b>区間推定の流れ</b>
データ$x_{1}$とデータ$x_{2}$が互いに独立にそれぞれ$N_{1}(\mu_{1}, \sigma^{2}_{1})$、$N_{2}(\mu_{2}, \sigma^{2}_{2})$に従うとする。
それぞれの標本から算出した不偏分散を$s^{2}_{1}, s^{2}_{2}$とするとき、
$$
F = \frac{s^{2}_{1} / \sigma^{2}_{1}}{s^{2}_{2} / \sigma^{2}_{2}}は自由度(n_{1} - 1, n_{2} - 1)のF分布に従う。
$$

$F$分布の特徴
・左右対称ではない
・自由度が2つある

<img src="03.png" width="500">


$F$分布表は上側2.5%点、上側5.0%点などの値しか表に載せられていない。
上側97.5%点などの値は、以下の式を使って求める。
$$
F(\phi_{1}, \phi_{2}, 1-P) = \frac{1}{F(\phi_{2}, \phi_{1}, P)}\quad(\phiは自由度、Pは2.5\%点などの面積、確率)
$$
\
証明：$p$を統計量$F_{0}$が棄却域に入る確率とすると、
$$
p = Pr\{F_{0} \geq F(\phi_{1}, \phi_{2}, P) \} = Pr\{F_{0} \leq F(\phi_{1}, \phi_{2}, 1-P) \} = Pr\{\frac{1}{F_{0}} \geq \frac{1}{F(\phi_{1}, \phi_{2}, 1-P)} \}\\
\,\\
また、F_{0} = \frac{s^{2}_{1} / \sigma^{2}_{1}}{s^{2}_{2} / \sigma^{2}_{2}}は自由度(\phi_{1}, \phi_{2})のF分布に従う。\\
\,\\
1と2を逆にすると、\frac{1}{F_{0}}=\frac{s^{2}_{2} / \sigma^{2}_{2}}{s^{2}_{1} / \sigma^{2}_{1}}は自由度(\phi_{2}, \phi_{1})のF分布に従う。\\
\,\\
すなわち、p = Pr\{\frac{1}{F_{0}} \geq F(\phi_{2}, \phi_{1}, P) \}\\
\,\\
よって、F(\phi_{2}, \phi_{1}, P) = \frac{1}{F(\phi_{1}, \phi_{2}, 1-P)}
$$


手順
①統計量$F$の式を考える（それぞれの不偏分散を算出する）。
②信頼係数95%の場合、統計量$F$が$F$分布の真ん中95%の面積の範囲にあれば良い。
③すなわち、左側2.5%(右側97.5%)、右側2.5%に入らなければ良い。
④$F$分布は左右対称ではないので、まず自由度$(\phi_{1}, \phi_{2})$のときの2.5%(0.025)の位置を$F$分布表から調べる。
⑤次に自由度の順番を逆にして、自由度$(\phi_{2}, \phi_{1})$のときの2.5%(0.025)の位置を$F$分布表から調べる。
⑥$F$分布表から、自由度(4, 5)のときの2.5%の位置は7.39だとわかる。
⑦$F$分布表から、自由度(5, 4)のときの2.5%の位置は9.36だとわかる。
⑧$F(\phi_{1}, \phi_{2}, 0.975)\leq\frac{s^{2}_{1} / \sigma^{2}_{1}}{s^{2}_{2} / \sigma^{2}_{2}}\leq F(\phi_{1}, \phi_{2}, 0.025)$が信頼係数95%の信頼区間なので、これを変形して $\frac{1}{F(\phi_{2}, \phi_{1}, 0.025)}\leq\frac{s^{2}_{1} / \sigma^{2}_{1}}{s^{2}_{2} / \sigma^{2}_{2}}\leq F(\phi_{1}, \phi_{2}, 0.025)$
⑨すなわち、$\frac{1}{9.36}\leq\frac{s^{2}_{1} / \sigma^{2}_{1}}{s^{2}_{2} / \sigma^{2}_{2}}\leq 7.39$
⑦これを$\frac{\sigma^{2}_{1}}{\sigma^{2}_{2}}$について解くと、$\frac{1}{7.39}\times \frac{s^{2}_{1}}{s^{2}_{2}} \leq\frac{\sigma^{2}_{1}}{\sigma^{2}_{2}}\leq 9.36\times \frac{s^{2}_{1}}{s^{2}_{2}}$となる。
⑧これが求めたい信頼区間となる。

■ 解答
1.　装置Aで製造した鉛筆の不偏分散：0.7、装置Bで製造した鉛筆の不偏分散：0.3
$$
\begin{align}
S_{A} &= (10^2 + 9^2 + 8^2 + 9^2 + 10^2) - \frac{(10+9+8+9+10)^2}{5}\\
&= 426 - 423.2\\
&= 2.8\\
S_{B} &= (10^2 + 10^2 + 9^2 + 9^2 + 9^2 + 10^2) - \frac{(10+10+9+9+9+10)^2}{6}\\
&= 543 - 541.5\\
&= 1.5\\
\,\\
s^{2}_{A} &= \frac{S_{A}}{5 - 1}\\
&=0.7\\
s^{2}_{B} &= \frac{S_{B}}{6 - 1}\\
&=0.3
\end{align}
$$

2.　95%信頼区間：(0.32, 21.8)
まず、統計量$F$を考える。
$$F = \frac{s^{2}_{A} / \sigma^{2}_{A}}{s^{2}_{B} / \sigma^{2}_{B}}$$

次に、自由度(4, 5)の右側2.5%(0.025)の位置を$F$分布表から調べる。
<img src="04.png" width="500">

7.39だとわかったので、次は自由度(5, 4)の右側2.5%(0.025)の位置を$F$分布表から調べる。
<img src="05.png" width="500">

9.36だとわかったので、$\frac{1}{9.36}\leq\frac{s^{2}_{A} / \sigma^{2}_{A}}{s^{2}_{B} / \sigma^{2}_{B}}\leq7.39$が信頼係数95%の信頼区間。
これを$\frac{\sigma^{2}_{A}}{\sigma^{2}_{B}}$について解く。
$$
\frac{1}{9.36}\leq\frac{s^{2}_{A} / \sigma^{2}_{A}}{s^{2}_{B} / \sigma^{2}_{B}}\leq7.39\\
\,\\
\frac{1}{9.36}\leq\frac{s^{2}_{A}}{s^{2}_{B}}\times \frac{\sigma^{2}_{B}}{\sigma^{2}_{A}}\leq7.39\\
\,\\
\frac{1}{7.39}\leq\frac{s^{2}_{B}}{s^{2}_{A}}\times \frac{\sigma^{2}_{A}}{\sigma^{2}_{B}}\leq9.36\\
\,\\
\frac{1}{7.39}\times \frac{s^{2}_{A}}{s^{2}_{B}}\leq\frac{\sigma^{2}_{A}}{\sigma^{2}_{B}}\leq9.36\times \frac{s^{2}_{A}}{s^{2}_{B}}\\
\,\\
$$となる。

最後に、文字に値を代入して信頼区間を求める。

$s^{2}_{A} = 0.7, s^{2}_{B} = 0.3$より、
$$
\frac{1}{7.39}\times \frac{0.7}{0.3}\leq\frac{\sigma^{2}_{A}}{\sigma^{2}_{B}}\leq9.36\times \frac{0.7}{0.3}\\
\,\\
\frac{1}{7.39}\times \frac{0.7}{0.3}\leq\frac{\sigma^{2}_{A}}{\sigma^{2}_{B}}\leq9.36\times \frac{0.7}{0.3}\\
\,\\
0.315\leq\frac{\sigma^{2}_{A}}{\sigma^{2}_{B}}\leq 21.84
$$
よって、95%信頼区間は(0.32, 21.8)

#### ■ 問6　Pythonを使って母分散の比の区間推定

Notebook参照


<br>
<br>

## 区間推定、検定で使う分布の対応表
| | 区間推定 | 検定 |
|:-:| :-: | :-: |
| 標準正規分布 | 母平均(母分散既知)<br>2標本の母平均の差(母分散既知)<br>母比率<br>2標本の母比率の差<br>相関係数 | 母平均(母分散既知)<br>2標本の母平均の差(母分散既知)<br>母比率<br>2標本の母比率の差 |
| t分布 | 母平均(母分散未知)<br>2標本の母平均の差(母分散未知) | 母平均(母分散未知)<br>2標本の母平均の差(母分散未知)<br>回帰係数 | 
| χ<sup>2</sup>分布 | 母分散 | 母分散<br>適合度検定<br>独立性の検定 |
| F分布 | 2標本の母分散の比 | 2標本の母分散の比<br>分散分析<br>回帰方程式 |

統計量が正規分布に従う場合で、
統計量が従う分布の分散がわかっている場合：標準正規分布
統計量が従う分布の分散がわからない場合(不偏分散を使う場合)：$t$分布

ばらつきを考える場合で、
ばらつきの度合いを考える場合：$\chi^{2}$分布
ばらつきの比を考える場合：$F$分布